name: Update Project Structure

on:
  push:
    branches: [ develop, master ]
  workflow_dispatch:

jobs:
  update-tree:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Install tree
        run: sudo apt-get update && sudo apt-get install -y tree

      # Generate tree for CarsAnalytics.SystemApi
      - name: Generate tree for CarsAnalytics.SystemApi
        run: |
          echo "## CarsAnalytics.SystemApi" > ProjectStructure.txt
          tree CarsAnalytics.SystemApi \
            -a \
            -I "bin|obj|Migrations|*.user|*.cache" \
            >> ProjectStructure.txt

      # Generate tree for CarsAnalytics.SystemApi.Tests
      - name: Generate tree for CarsAnalytics.SystemApi.Tests
        run: |
          echo "" >> ProjectStructure.txt
          echo "## CarsAnalytics.SystemApi.Tests" >> ProjectStructure.txt
          tree CarsAnalytics.SystemApi.Tests \
            -a \
            -I "bin|obj|*.user|*.cache" \
            >> ProjectStructure.txt

      # Commit changes to the SAME branch where workflow was triggered
      - name: Commit changes
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "Update project structure"
          file_pattern: ProjectStructure.txt
          branch: ${{ github.ref_name }}